%aside
  .row.no-margin
    %ul.tabs.tabs-border
      %li.tab.col.s4= link_to material_icon('chat'), '#chat'
      %li.tab.col.s4= link_to material_icon('supervisor_account'), '#users'
      %li.tab.col.s4= link_to material_icon('settings'), '#settings'

  #chat.content
    .system-notice
      Welcome to #{@lobby.name}

  #users.content
    %ul.collection.no-border
      - @lobby.lobby_users.each do |gl_user|
        %li.collection-item.avatar{data: { user_id: gl_user.guid }}
          = image_tag gl_user.avatar_url, class: 'img-responsive circle'
          %span.title{class: (gl_user.admin? ? 'teal-text' : (gl_user.moderator? ? 'blue-text' : '')) }= gl_user.name
          - if gl_user.user
            .username.smaller.grey-text @#{gl_user.user.username}
          - else
            .username.smaller.grey-text.text-lighten-1 (guest)


  #settings.content
    .card-content
      .center= link_to 'Leave Lobby', lobby_user_path(@lobby_user), method: :delete, class: 'btn red darken-2 center'

  - if logged_in?
    .chat-form
      = simple_form_for [@lobby, Message.new], remote: true do |f|
        .input-field.inline
          = f.input_field :message, as: :string, placeholder: 'Send a message...'
        %button.btn{type: 'submit'}= material_icon('send')

  - else
    .chat-form
      %p.grey-text.center You must sign in or register to chat.

%script#lobby-chat-template{type: 'text/html'}
  .chat-notice{class: ''}
    %img{src: '${lobby_user.avatar_url}', alt: "${lobby_user.name}"}
    {{if lobby_user.admin}}
    .rank-icon{class: 'admin'}= material_icon('star')
    {{/if}}
    {{if lobby_user.moderator}}
    .rank-icon{class: 'moderator'}= material_icon('circle')
    {{/if}}
    .name ${lobby_user.name}
    .message ${message}

- @lobby.messages.last(10).each do |message|
  :javascript
    Lobby.chat(#{message.lobby_user.to_json}, "#{message.message}")
